{"dependencies":[{"name":"./state.js"},{"name":"./statehandler.js"},{"name":"./touchHandler.js"},{"name":"./markerHandler.js"},{"name":"./mouseMoveHandler.js"},{"name":"./mouseButtonHandler.js"},{"name":"./pageScrollHandler.js"},{"name":"./windowSizeHandler.js"},{"name":"./windowPositionHandler.js"},{"name":"./windowUnloadHandler.js"},{"name":"./visibilityChangeHandler.js"},{"name":"./transport.js"},{"name":"util"},{"name":"./keyStrokeHandler.js"}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); // ! ci-trap v0.2.0 - MIT license \n\n\n// Motion event (mouse movement) catcher for browsers emitting data compatible\n// with Cursor Insight's motion analyzer engine. (touch, gyro, etc. is WIP)\n\n// Copyright (c) 2012--2014, GOLDA Bence <gbence@algernon.hu>\n//                     2014, GOLDA Bence <bence@cursorinsight.com>\n//                     2014, TÖRTELI Olivér <oliver@cursorinsight.com>\n\n// # Data format (in ~BNF) ##########################################\n\n//    <data> ::= <version> <headers> <events>\n// <headers> ::= <header-size:12b> <url-encoded-string:<header-size in bytes>>\n//  <events> ::= <event> <events> | EOS\n//   <event> ::= <mouse-move> | <mouse-button>\n//            | <touch-move> | <touch-change>\n//             | <scroll-change>\n//             | <mouse-wheel-x> | <mouse-wheel-y>\n//             | <window-size-change> | <window-position-change>\n//             | <visibility-change> | <unload>\n//             | <marker> | <state>\n\n// // this is (and will be) always a constant and a version id\n// <version>        ::= \"B\" <version-letter>\n// <version-letter> ::= \"A\" | \"B\" | \"C\" | \"D\" ...\n\n// // sum: 60b\n// <mouse-move> ::= 0b0000 <time-difference:20b>\n//                  <mouse-screen-x:18b> <mouse-screen-y:18b>\n\n// <touch-move> ::= 0b0001 <time-difference:20b>\n//                  <empty:1b> <touch-id:5b>\n//                  <touch-screen-x:18b> <touch-screen-y:18b>\n\n// TODO: return only the differences and put \"markers\" (as full frames in\n// video) into the stream\n\n// // sum: 66b\n// <mouse-button> ::= 0b0010 <time-difference:20b>\n//                    <button-state:1b> <button-definition:5b> // button-state == 1 for \"down\", == 0 for \"up\"\n//                    // <mouse-screen-x:18b> <mouse-screen-y:18b>\n\n// <touch-change> ::= 0b0011 <time-difference:20b>\n//                    <touch-state:1b> <touch-id:5b> // touch-state == 1 for \"down\"/\"start\", == 0 for \"up\"/\"end\"\n//                    <touch-screen-x:18b> <touch-screen-y:18b>\n\n// // sum: 48b\n// <scroll-change> ::= 0b0100 <time-difference:20b>\n//                     <sign-of-dx:1b> <abs-dx:11b>\n//                     <sign-of-dy:1b> <abs-dy:11b>\n\n// // sum: 36b\n// <mouse-wheel-x> ::= 0b0110 <time-difference:20b>\n//                     <sign-of-d:1b> <abs-d:11b>\n\n// // sum: 36b\n// <mouse-wheel-y> ::= 0b0111 <time-difference:20b>\n//                     <sign-of-d:1b> <abs-d:11b>\n\n// // sum: 54b\n// <window-size-change> ::= 0b1000 <time-difference:20b>\n//                          <inner-window-width:15b> <inner-window-height:15b>\n\n// // sum: 54b\n// <window-position-change> ::= 0b1001 <time-difference:20b>\n//                             <window-position-left:15b> <window-position-top:15b>\n\n// // sum: 24b\n// <visibility-change> ::= 0b1010 <time-difference:20b> // (visible/focused)\n// <visibility-change> ::= 0b1011 <time-difference:20b> // (hidden/idle)\n\n// // sum: 24b\n// <unload> ::= 0b1100 <time-difference:20b>\n\n// // sum: variable\n// <marker> ::= 0b1110 <time-difference:20b>\n//              <size:12b> <url-encoded-string:<size in bytes>>\n\n// // sum: 4+20+42+(12*18) = 282b\n// <state> ::= 0b1111 <time-difference:20b>\n//             <current-time-stamp:42b>\n//             <mouse-screen-x:18b> <mouse-screen-y:18b>\n//             // <mouse-client-x:18b> <mouse-client-y:18b> // temporarily disabled\n//             <page-scroll-x(left):18b> <page-scroll-top-y(top):18b>\n//             <inner-window-width:18b> <inner-window-height:18b>\n//             <outer-window-width:18b> <outer-window-height:18b>\n//             <window-position-left:18b> <window-position-top:18b>\n//             <screen-width:18b> <screen-height:18b>\n\n// JsDoc keyword:\n// https://code.google.com/p/jsdoc-toolkit/wiki/TagReference\n\n// @link ClassName#CITrap\n\n\n//import  MouseWheelHandler = from \"./mouseWheelHandler.js\";\n\n\nvar _state = require(\"./state.js\");\n\nvar _state2 = _interopRequireDefault(_state);\n\nvar _statehandler = require(\"./statehandler.js\");\n\nvar _statehandler2 = _interopRequireDefault(_statehandler);\n\nvar _touchHandler = require(\"./touchHandler.js\");\n\nvar _touchHandler2 = _interopRequireDefault(_touchHandler);\n\nvar _markerHandler = require(\"./markerHandler.js\");\n\nvar _markerHandler2 = _interopRequireDefault(_markerHandler);\n\nvar _mouseMoveHandler = require(\"./mouseMoveHandler.js\");\n\nvar _mouseMoveHandler2 = _interopRequireDefault(_mouseMoveHandler);\n\nvar _mouseButtonHandler = require(\"./mouseButtonHandler.js\");\n\nvar _mouseButtonHandler2 = _interopRequireDefault(_mouseButtonHandler);\n\nvar _pageScrollHandler = require(\"./pageScrollHandler.js\");\n\nvar _pageScrollHandler2 = _interopRequireDefault(_pageScrollHandler);\n\nvar _windowSizeHandler = require(\"./windowSizeHandler.js\");\n\nvar _windowSizeHandler2 = _interopRequireDefault(_windowSizeHandler);\n\nvar _windowPositionHandler = require(\"./windowPositionHandler.js\");\n\nvar _windowPositionHandler2 = _interopRequireDefault(_windowPositionHandler);\n\nvar _windowUnloadHandler = require(\"./windowUnloadHandler.js\");\n\nvar _windowUnloadHandler2 = _interopRequireDefault(_windowUnloadHandler);\n\nvar _visibilityChangeHandler = require(\"./visibilityChangeHandler.js\");\n\nvar _visibilityChangeHandler2 = _interopRequireDefault(_visibilityChangeHandler);\n\nvar _transport = require(\"./transport.js\");\n\nvar _transport2 = _interopRequireDefault(_transport);\n\nvar _util = require(\"util\");\n\nvar _keyStrokeHandler = require(\"./keyStrokeHandler.js\");\n\nvar _keyStrokeHandler2 = _interopRequireDefault(_keyStrokeHandler);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar CITrap = function () {\n  function CITrap() {\n    var element = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : window.document;\n    var idleTimeout = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n\n    _classCallCheck(this, CITrap);\n\n    var windowAlias = window,\n        documentAlias = window.document,\n        undefinedAlias;\n\n    var windowSupport = element === windowAlias || element === documentAlias,\n        touchSupport = \"ontouchstart\" in windowAlias || // works on most browsers\n    \"onmsgesturechange\" in windowAlias; // works on ie10\n\n\n    // Set up defaults.\n    if (element === undefinedAlias) {\n      this.element = documentAlias;\n    } else {\n      this.element = element;\n    }\n\n    // master loop\n    this.running = false;\n\n    // Buffer + transport\n    this.transport = new _transport2.default(windowAlias);\n\n    // State\n    this.state = new _state2.default(windowAlias, this.transport, idleTimeout);\n\n    // Handlers\n    this.handlers = new Array(this.state);\n\n    this.markerHandler = new _markerHandler2.default(windowAlias, documentAlias, element, this.state, this.transport);\n\n    this.handlers.push(new _statehandler2.default(windowAlias, documentAlias, element, this.state, this.transport));\n    this.handlers.push(this.markerHandler);\n    this.handlers.push(new _mouseMoveHandler2.default(element, this.state, this.transport));\n    this.handlers.push(new _mouseButtonHandler2.default(element, this.state, this.transport));\n    this.handlers.push(new _keyStrokeHandler2.default(element, this.state, this.transport));\n\n    // IE 6, 7, 8 does not support scroll event on document\n    // http://www.quirksmode.org/dom/events/scroll.html\n    this.handlers.push(new _pageScrollHandler2.default(element === documentAlias ? windowAlias : element, this.state, this.transport));\n\n    // handlers.push(new MouseWheelHandler.default.prototype.constructor(element, state, transport));\n\n    if (windowSupport) {\n      this.handlers.push(new _windowSizeHandler2.default(windowAlias, this.state, this.transport));\n      this.handlers.push(new _windowPositionHandler2.default(windowAlias, documentAlias, this.state, this.transport));\n      this.handlers.push(new _windowUnloadHandler2.default(windowAlias, this.state, this.transport));\n      this.handlers.push(new _visibilityChangeHandler2.default(windowAlias, this.state, this.transport));\n    }\n\n    if (touchSupport) {\n      this.handlers.push(new _touchHandler2.default(element, this.state, this.transport));\n    }\n\n    this.start = this.start.bind(this);\n    this.stop = this.stop.bind(this);\n  }\n  /*\r\n   * Public methods\r\n   */\n\n  /**\r\n   *  Starts event processing.\r\n   */\n\n\n  _createClass(CITrap, [{\n    key: \"start\",\n    value: function start(options) {\n      if (this.running) {\n        return;\n      }\n      options = options || {};\n      var length = this.handlers.length,\n          i = 0;\n      for (; i < length; i++) {\n        if (this.handlers[i] !== _util.isNullOrUndefined && typeof this.handlers[i].start === \"function\") {\n          this.handlers[i].start(options);\n        }\n      }\n      this.running = true;\n    }\n\n    /**\r\n     *  Stops event processing.\r\n     */\n\n  }, {\n    key: \"stop\",\n    value: function stop() {\n      if (!this.running) {\n        return;\n      }\n      var length = this.handlers.length,\n          i = 0;\n      for (; i < length; i++) {\n        if (this.handlers[i] !== _util.isNullOrUndefined && typeof this.handlers[i].stop === \"function\") {\n          this.handlers[i].stop();\n        }\n      }\n      this.running = false;\n    }\n  }, {\n    key: \"buffer\",\n    value: function buffer() {\n      return this.transport.getBuffer();\n    }\n  }, {\n    key: \"send\",\n    value: function send() {\n      return this.transport.send.apply(this, arguments);\n    }\n  }, {\n    key: \"setHeader\",\n    value: function setHeader() {\n      return this.transport.setHeader.apply(this, arguments);\n    }\n  }, {\n    key: \"setUrl\",\n    value: function setUrl() {\n      return this.transport.setUrl.apply(this, arguments);\n    }\n  }, {\n    key: \"setSessionID\",\n    value: function setSessionID() {\n      return this.transport.setSessionID.apply(this, arguments);\n    }\n  }, {\n    key: \"mark\",\n    value: function mark(text) {\n      if (this.markerHandler) {\n        this.markerHandler.trigger(text);\n      }\n    }\n  }]);\n\n  return CITrap;\n}();\n\n;\n\n/**\r\n * Expose CITrap\r\n */\nexports.default = CITrap;"},"hash":"1819153eddd95fb547a356d525735063"}