{"dependencies":[],"generated":{"js":"/* global module */\r\n\r\nvar WindowPositionHandler = function(window, document, state, buffer) {\r\n\"use strict\";\r\n// ---------------------------------------------------------------------------\r\n\r\nvar\r\n  eventName = \"positionchanged\",\r\n  longDelay = 1000 / 2, // 2fps\r\n  shortDelay = 1000 / 15, // 15fps\r\n  throttleBase = 15, // it's a \"constant\"\r\n  throttleCount = throttleBase,\r\n  timeout,\r\n\r\n  windowPositionX = function() {\r\n    return window.screenX || window.screenLeft || 0;\r\n  },\r\n\r\n  windowPositionY = function() {\r\n    return window.screenY || window.screenTop || 0;\r\n  },\r\n\r\n  handler = function(event) {\r\n    var dT = state.getDT(null, 20);\r\n\r\n    state.windowPositionX = event.x;\r\n    state.windowPositionY = event.y;\r\n\r\n    // type = 0b1001\r\n    buffer.push([9, dT, event.x, event.y],\r\n                [4, 20,      15,      15]);\r\n  },\r\n\r\n  poller = function() {\r\n    var\r\n      x = windowPositionX(),\r\n      y = windowPositionY();\r\n\r\n    if (state.windowPositionX !== x || state.windowPositionY !== y) {\r\n      var event = document.createEvent(\"CustomEvent\");\r\n      event.initEvent(eventName, true, false);\r\n      event.x = x;\r\n      event.y = y;\r\n      window.dispatchEvent(event);\r\n\r\n      throttleCount = throttleBase;\r\n    }\r\n\r\n    if (throttleCount > 0) {\r\n      throttleCount--;\r\n      timeout = window.setTimeout(poller, shortDelay);\r\n    } else {\r\n      timeout = window.setTimeout(poller, longDelay);\r\n    }\r\n  },\r\n\r\n  startPoller = function() {\r\n    window.setTimeout(poller, longDelay);\r\n  },\r\n\r\n  stopPoller = function() {\r\n    if (timeout) {\r\n      window.clearTimeout(timeout);\r\n    }\r\n  };\r\n\r\nthis.start = function() {\r\n  state.windowPositionX = windowPositionX();\r\n  state.windowPositionY = windowPositionY();\r\n  window.addEventListener(eventName, handler, false);\r\n  startPoller();\r\n};\r\n\r\nthis.stop = function() {\r\n  stopPoller();\r\n  window.removeEventListener(eventName, handler, false);\r\n};\r\n\r\n// ---------------------------------------------------------------------------\r\n};\r\n\r\nmodule.exports = WindowPositionHandler;\r\n"},"hash":"3a93a00b63c4f886bb7fd551155483ad"}